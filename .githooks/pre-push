#!/bin/bash
# Git pre-push hook - Auto bump version before pushing to production

# Only run if pushing to main/master branch
while read local_ref local_sha remote_ref remote_sha
do
  if [[ "$remote_ref" == "refs/heads/main" ]] || [[ "$remote_ref" == "refs/heads/master" ]]; then
    echo "Auto-bumping version before push to production..."
    
    # Run version bump script
    node scripts/bump-version-auto.js --quiet > /dev/null
    
    # Add package.json to staging
    git add package.json
    
    # Commit version bump
    VERSION=$(node scripts/bump-version-auto.js --quiet 2>/dev/null || node -e "const pkg=require('./package.json');console.log(pkg.version)")
    git commit -m "chore: Auto-bump version to v${VERSION}" --no-verify
    
    echo "Version bumped and committed"
  fi
done

exit 0
